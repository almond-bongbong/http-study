---
marp: true
title: HTTP - Cookie
---

# Cookie

---

# 왜 쿠키?

HTTP는 상태가 없는 프로토콜이다.
즉, 요청과 응답이 끝나면 연결이 끊기고 상태 정보가 유지되지 않는다.
로그인 상태를 유지하거나 쇼핑카트를 유지하기 위해서는 상태 정보를 유지해야 한다.
쿠키는 상태 정보를 유지하기 위해 사용된다.

---

# 쿠키의 구조

- 이름
- 값
- 만료시간
  - 세션 쿠키
  - 영속 쿠키
- 도메인
- 경로
- 보안옵션
  - Secure
  - HttpOnly
  - SameSite

---

## 이름, 값

- KEY=VALUE 형태로 저장된다.
- 이름은 중복되면 안된다.

---

## 만료시간

- `Set-Cookie: expires=Sat, 26-Dec-2020 04:39:21 GMT`
- 쿠키는 만료시간이 지나면 삭제된다. (영속쿠키)
- 만료시간이 지정되지 않으면 브라우저 종료시 삭제된다. (세션쿠키)
  - 탭 종료시에는 삭제 X
  - 창 종료시에는 삭제 O

---

## 도메인
쿠키가 전송될 URL을 지정한다.

- `Set-Cookie: domain=.example.org`
  - 하위 도메인에도 쿠키가 전송된다.
- `Set-Cookie: domain=example.org`
  - 현재 도메인에만 쿠키가 전송된다.

---

## 경로
쿠키가 전송될 Path를 지정한다.

- `Set-Cookie: path=/`
  - 모든 URL에 쿠키가 전송된다.
- `Set-Cookie: path=/example`
  - /example 경로에만 쿠키가 전송된다.

---

## 보안옵션
쿠키는 기본적으로 페이지 요청시 전송이 된다.
FE에서 XHR 요청시에도 쿠키를 추가 할 수 있지만 보안상 여러가 제한이 있다.  

🤔 쿠키가 전송된다는 것이 생각해보면 위험한 경우가 있다. (CSRF)

---

## Secure
쿠키가 HTTPS 연결을 사용할 때만 전송되도록 한다.

🤔 HTTP 환경의 JS에서 접근한다면?

---

## HttpOnly

쿠키가 HTTP 요청에서만 전송되도록 한다. 즉, JS에서 접근할 수 없다.

스크립트를 이용한 공격(XSS)에 대한 취약점을 줄이기 위해 사용

---

## SameSite

가장 난해하고 복잡한 쿠키 옵션
SameSite 옵션이 필요한 이유를 알기 위해서는 CSRF 공격에 대해 알아야 한다.

예제를 보자

---

- None
  - 제한 없음
- Strict
  - 요청이 사이트 외부에서 일어날 때 (폼전송, 링크이동, 브라우저에 URL 입력 등) strict로 설정된 쿠키는 전송되지 않는다
  - 문제가 발생한다
- Lax
  - 기본적으로는 strict와 같으나 예외사항을 두었다. 
  - GET 요청과 같은 안전한 메소드에서 쿠키가 전송
  - 브라우저 주소창에 URL을 입력하는 최상위 레벨 탐색인 경우 쿠키가 전송
